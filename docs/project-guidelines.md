# Project Guidelines

## 概要
本プロジェクトはNext.js(TypeScript)＋Azure Static Web Apps構成のセキュリティ人材向けAIサービスPoCです。

## ディレクトリ構成
- `src/` ... アプリ本体
- `public/` ... 静的ファイル
- `docs/` ... ドキュメント（本ファイル含む）
- `package.json` ... 依存・スクリプト
- `.env.local` ... ローカル用環境変数

## 開発・運用フロー
1. ローカルで `npm install` → `npm run dev` で動作確認
2. Azure Static Web Appsへデプロイ（GitHub Actions推奨）
3. 環境変数はAzureポータルで設定

## Azure移行時の注意
- API Routeは `/api/` 配下でFunctions化される
- 認証Callback URLや環境変数は本番用に修正
- `staticwebapp.config.json` でルーティング・認証制御

---
## 主要な機能と実装 (2025/07/14時点)

### データベース基盤 (PostgreSQL + Prisma)
- **データストア**: 当初利用していた **Azure Blob Storage** (JSONファイル管理) から、**PostgreSQL** へ完全に移行。データの整合性、検索性、拡張性を確保。
- **ORM**: **Prisma** を採用し、型安全なデータベースアクセスを実現。

### 人材プロフィール機能 (`/pages/talent/profile`)
- ユーザー（Talent）が自身の経歴やスキルを登録・編集する機能。
- **動的フォーム**: 「社会人」「学生」の選択に応じて、卒業年度やインターン希望のチェックボックスなど、表示される入力項目が動的に変化する。
- **データ同期**: スキルや資格といった多対多の関連を持つデータも、プロフィール全体の保存時に単一のAPIコール（`/api/talent/profile`）と単一のDBトランザクションで安全に更新（洗い替え方式で同期）される。

### AI診断機能
- ユーザープロフィールと後述の「AI抽出スキル」をインプット情報として利用し、キャリア診断や学習計画を生成する。
- **データモデル**: `AnalysisResult` (診断結果), `LearningRoadmapStep` (学習計画)
- **詳細のオンデマンド生成**: 学習計画の各ステップの詳細は、ユーザーがクリックしたタイミングでオンデマンドにAIが生成し、DBにキャッシュする。

### AIスキルインタビュー機能
AIとのチャットを通じて、ユーザーの潜在的なスキルや経験を抽出し、AI診断の精度を高める機能。

- **データモデル**:
    - `SkillInterview`: インタビューのセッション情報を管理。
    - `SkillInterviewMessage`: AIとユーザーの発言履歴をすべて記録。
    - `AiExtractedSkill`: ユーザーの公式プロフィールとは別に、AIが抽出したスキル（技術、役割・経験、ソフトスキル）をそのまま格納。これにより、AIの不確実な判断を許容しつつ、診断のインプットとして活用する。

- **スキル抽出のバックグラウンド処理**:
    - ユーザーが「スキル抽出」ボタンを押すと、APIはすぐに「処理中」のステータスを返し、ユーザーを待たせない。
    - **`start` API**が処理開始をDBに記録し、**`execute` API**がバックグラウンドで時間のかかるAIとの通信を実行する。
    - フロントエンドは**ポーリング**（数秒おきの状況確認）で**`status` API**を呼び出し、処理の完了を検知する。これはサーバーレス環境のタイムアウトを回避するための設計。

- **確認UI (`/pages/talent/skill-check`)**:
    - スキル抽出完了後、ユーザーはこのページに遷移し、AIがどのようなスキルを抽出したかを確認できる。
