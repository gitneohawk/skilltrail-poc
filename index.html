<script>
  const loginLink = document.getElementById("login-link");

  async function checkAuth() {
    try {
      const res = await fetch("/.auth/me", { credentials: "include" });
      const data = await res.json();
      if (data.clientPrincipal) {
        // ログイン済み
        loginLink.textContent = "ログアウト";
        loginLink.href = "#";
        loginLink.onclick = () => {
          sessionStorage.clear();
          window.location.href = "/.auth/logout?post_logout_redirect_uri=/";
        };
      } else {
        // 未ログイン
        loginLink.href = `/login.html?returnTo=${encodeURIComponent(window.location.pathname)}`;
      }
    } catch (e) {
      loginLink.href = `/login.html?returnTo=${encodeURIComponent(window.location.pathname)}`;
    }
  }

  checkAuth();
</script>
