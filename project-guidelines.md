# 📌 SkillTrail PoC - ChatGPT向け開発ガイドライン

## 🗂️ プロジェクト構成

skilltrail-poc/
├── pages/
│   ├── api/ai/           # 各種AI関連のAPIエンドポイント
│   ├── auth/             # NextAuthによる認証処理
│   ├── candidate/        # 候補者向けの画面UI
│   ├── profile-history/  # プロファイル履歴表示
│   └── …               # その他UIページ
├── types/                # 型定義（TypeScriptインタフェース）
├── utils/                # 共通ユーティリティ関数（Blob操作等）
├── styles/               # グローバルCSS
└── その他設定ファイル

---

## ✅ コーディングルール

### 1. **型定義と再利用**
- データ構造はすべて `types/` に定義済みの型を使用すること（例: `CandidateProfile`）。
- 同じ構造の再定義は禁止。既存の型をインポートして使用。

### 2. **共通処理の再利用**
- Azure Blob Storage の操作はすべて `utils/azureBlob.ts` を使用。
- ストリームやプロファイル関連も `utils/` の既存関数を使うこと。
- 同じ処理を別関数・別ファイルで重複実装しない。
- 関連ファイルを先にスキャンしてからコードを提案すること。

### 3. **API実装**
- AI関連処理のAPIは `pages/api/ai/` に追加。
- `career-trail.ts` や `skill-interview.ts` などの既存処理に似た新機能は、まず既存コードの再利用を検討。
- エンドポイントとUIの対応関係を崩さない。

### 4. **UI開発**
- UIコンポーネントは `pages/candidate/...` や `pages/profile-history/` に配置。
- 状態管理やイベント処理は最小限で、再利用可能に保つ。
- `skill-chat.tsx` はインタビューUI。これと重複するコンポーネントを作らない。

### 5. **型の運用方針**
- 勝手に型を作らず、types/ の型に新しいプロパティを追加する場合にはhatGPTからの提案 → 人手による確認 → types修正というフローとする。

### 6. **ローカル開発環境の想定**
- `localhost:3000` での動作を前提とし、絶対パス指定ではなく相対パス(`/api/...`)を使用する。
- POST/GET リクエスト送信前に `Next.js` の API ファイル名が正しいか・拡張子 `.ts` の不要参照がないか確認する。

### 7. **エラーハンドリングの方針**
- `try/catch` 内では `console.error()` だけでなく、UIに反映するエラー状態（例：`setStatus('error')`）を伴うようにする。
- APIレスポンスエラー（404, 500など）は開発初期から `devtools` の Networkタブで検証する手順を明示。

### 8. **ChatGPTとのやり取り時のチェックリスト**
> ChatGPTによるコード生成前に以下を確認する（internal use）

- [ ] 使用するデータ構造の型は `types/` に既に存在するか？
- [ ] 同様の関数が `utils/` や他の API に存在しないか？
- [ ] UIの場合、既存の `pages/candidate/` に該当ページがないか？
- [ ] APIエンドポイントが UIと一対一で対応しているか？
- [ ] 呼び出すAPIのファイルが `pages/api/` に確実に存在しているか？
- [ ] 仮のAPIや仮定ファイルを参照していないか？
- [ ] `oboe` を使うならファイルを一つに限定しているか？

### 9. **命名規則の明示（推奨）**
- API：`動詞-目的語.ts` 形式例：`generate-resume.ts`, `extract-skills.ts`
- 型：PascalCase (`CandidateProfile`)
- UIページ：`pages/candidate/`以下は`useCase.tsx`形式（例: `skill-chat.tsx`）

---

## ❌ 禁止事項

- 既存の型やユーティリティを無視した新規実装
- 同じ処理を少し変えた形で重複作成すること
- チャットやUI処理を複数のファイルで分散実装すること
- oboeで複数ファイル用のコードを一度に生成すること

---

## 📣 ChatGPTへのお願い

このガイドラインに従って、以下の方針でコードを作成・修正してください：

- 既存の型とユーティリティを最優先で再利用
- 機能の目的と一致する既存ファイルを確認してからコードを生成
- 同じディレクトリに似た処理があれば統合を検討
- oboeでコードを生成する場合には、必ず事前に対象となるファイルを確認


### 10. **API・パス設計における厳格ルール（NEW）**
- 呼び出すAPIエンドポイントは、**必ず `pages/api/` に存在するファイルと一致していることを確認する**（例：`/api/ai/skill-interview`）。
- 存在しないAPI（例：`/api/blob/load-skill-interview`）を仮定したコードの追加は**厳禁**。
- UI側で `fetch()` などを使う際は、該当APIファイルを必ず一度確認・レビューする。
- ChatGPT経由で生成したコードは、**対象ファイルが存在するか構成ツリーで必ず検証する**。

### 11. **過去のデグレードを踏まえた注意点（2025年6月23日追加）**

- `/api/blob/load-skill-interview` のような、**存在しないAPIを仮定してUI側を更新した結果、過去に正常動作していた機能がデグレードした**事例が発生。
- **必ず、既存APIと一致することをファイル構成ツリーで確認してから `fetch()` や `axios` を記述すること。**
- 特に `skill-chat.tsx` のようなチャットUIは機能の整合性が崩れると検証が困難になるため、**仕様確認とAPI存在チェックを徹底すること**。